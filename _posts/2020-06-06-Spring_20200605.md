---
layout:            post
title:             "SpringBoot - DB연동하기(feat. Lombok 적용)"
menutitle:         "SpringBoot - DB연동하기(feat. Lombok 적용)"
tags:              spring
category:          Spring
author:            geunyoung
cover:             /assets/mountain-alternative-cover.jpg
published:         true
language:          KO
comments:          true
---

## 들어가기 앞서...

 앞의 "스프링부트 시작하기" 프로젝트에서 이어서 진행하며, DB 및 table 생성 등 일반적인 스프링 프로젝트와 겹치는 내용은 최대한 생략하고 다른점들에 대해서만 작성할 예정이며, 아래의 링크에 스터디용 프로젝트 올리니 참고바란다.  
  
 - https://github.com/rmsdud2435/미정

### 시작하기

  1) 우선 Lombok부터 프로젝트에 적용시킬 예정이다. Lombok은 중복되거나 노가다 작업인 부분들을 어노테이션을 통해 할 일을 줄여주는 라이브러리이며 대표적으로 @Getter, @Setter, @Tostring, @AllArgsConstructor 등이 있다. 아마 소스를 보면 어떻게 쓰이는지 알 수 있을 것이다. 이제 프로젝트에 적용을 시켜보자. 프로젝트 우클릭 -> Spring -> EditStarters -> Lombok 추가
  
  2) 이제 프로젝트에 롬복 적용은 끝났다. 하지만 Lombok의 사용은 기존 코딩 방식을 반하는 방식이기에 Eclispe Tool의 경우에는 lombok 라이브러리를 사용하는 class를 호출할 때 에러가 난다. 그러기에 tool에 강제 적용을 시켜줘야 한다. 프로젝트에 Maven Dependencies에서 lombok jar를 찾은 후, 우클릭 properties에서 위치를 찾아 파일 탐색기에서 해당 jar를 찾는다. 
  
  3) jar를 클릭하면 고추모양의 아이콘과 함께 뭘 install하라고 뜬다.(만약 실행이 압축프로그램으로 default로 되어있으면 클릭이 안될텐데, 그러면 관리자 권한으로 cmd켜서 해당 위치까지 찾아간후, java -jar lombok-버전.jar 실행) specify location을 클릭 후, 적용하고자 하는 eclipse tool의 실행 아이콘을 넣어준 후, install을 진행하면 된다.
   
  4) 확인하고 싶다면 install한 eclipse tool에 가서 .ini파일을 편집기로 켜보면 -javaagent:파일경로\lombok.jar가 추가된 것을 볼 수 있다.
  
  5) lombok을 활용하여 Dto 작성
  ex)
  ```java
package com.example.demo.dto;

import lombok.Getter;
import lombok.Setter;
import lombok.ToString;

@Getter
@Setter
@ToString
public class UserDto {

	private String userId;
	private String name;
	private String password;
	private String phone;
	private String email;
}
  ```
  
  5) 이제 MyBatis를 인식시켜보자. application.properties에 아래의 내용 추가  
  ```properties
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.config-location=classpath:mapper/config/mybatis-config.xml
  ```
  참고로 classpath는 이클립스 기준 프로젝트 우클릭 -> properties -> Java Build Path -> Order and Export에서 확인가능하다.  
  
  6) 해당 위치에 각각 매퍼와 마이바티스 설정파일 추가(일반 스플링은 bean factory, DTD 등을 통해 매퍼와 설정파일을 인식시키게 위해 많은 과정을 거치지만 스프링부트는 설정파일은 경로변수 빼고 굳이 안넣어줘도 된다.) 예시는 아래와 같다.
  ```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.demo.dao.UserDao">

    <select id="listPerson" resultType="com.example.demo.dto.UserDto">
        select * from user
    </select>

    <select id="findById" parameterType="String" resultType="com.example.demo.dto.UserDto">
        select * from user where user_id=#{userId}
    </select>

    <insert id="addPerson" parameterType="com.example.demo.dto.UserDto">
        INSERT INTO
        user (user_id, name , password,  phone, email)
        VALUES(#{userId},#{name},#{password},#{phone},#{email})
    </insert>

    <update id="updatePerson" parameterType="com.example.demo.dto.UserDto">
        UPDATE user
        SET
            name=#{name},
            password=#{password},
            phone=#{phone},
            email=#{email},
        WHERE
            user_id=#{userId}
    </update>

    <delete id="deletePerson" parameterType="String">
        DELETE FROM user
        WHERE user_id=#{userId}
    </delete>

</mapper>

  ```
  
  ```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd">

<configuration>
    <settings>
        <setting name="mapUnderscoreToCamelCase" value="true"/>
        <setting name="callSettersOnNulls" value="true"/>
        <setting name="jdbcTypeForNull" value="NULL"/>
    </settings>
</configuration>
  ```
  
  해당 설정 부분들은 스프링부트가 아닌 설정이라서 대충 설명하자면 mapUnderscoreToCamelCase는 DB의 user_id 등의 컬럼 형식을 userId 등의 형식 변수로 매핑시켜주며, callSettersOnNulls는 쿼리 결과 필드가 null인 경우 누락이 되서 나오는데 누락이 안되게 하는 설정이고, jdbcTypeForNull는 쿼리에 보내는 파라메터가 null인 경우, 오류 발생하는 것 방지해주는 설정이다.
  
  
  
  
  1) https://spring.io/tools에서 STS를 다운받는다.(Tool은 tool일 뿐이니 굳이 이것까지 따라할 필요는 없고 익숙한 것으로 시작)
  
  2) New -> Spring Starter Project 클릭 후, Next 
  
  3) 본인이 만들고픈 자바버전 및 Group, Artifact 작성 후, Next
  
  4) 정말 기본적인 Dependency 추가(내 기준, Spring Boot DevTools(소스 수정시 자동으로 재시작), Spring Web(각종 유용한 어노테이션들), Mybatis framework(JPA 관련도 추후 작성 예정), MySQL Driver(본인이 사용할 DB Driver로 선택))
    
  5) 프로젝트 생생되었으면 아마 퍄키지 형식의 프로젝트로 안보일 것이다. 그렇다면, 프로젝트 우클릭 -> Configure -> Convert to Maven Project 클릭 후 로딩 대기(혼자 스터디할때는 안떠서 당황했으나 Configure -> Gradle어쩌고저쩌고 클릭하니 내가 아는 프로젝트 형식으로 바뀜)
  
  6) resource 밑에 application.properties에 아래의 내용 추가 
```properties
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/본인DB?useSSL=false&serverTimezone=Asia/Seoul
spring.datasource.username=본인의 계정
spring.datasource.password=본인의 비밀번호

mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.config-location=classpath:mapper/config/mybatis-config.xml
```
  
  7) 처음에 설정했던 기본 package에 DemoApplication이라는 java 파일이 있을텐데 그 밑의 패키지로 만들어 Controller, Service, Dto 등 어노테이션이 필요한 파일들은 그 밑에다 작성(소스는 위의 Git 링크에 올라간 소스 참고)하면 된다.
  
  8) 이제 Spring Boot를 활용해서 편하게 개발해보자(굳이, 스프링부트에 국한이 아닌 이번에 배운 내용들을 작성할 예정)
  
  9) 페이지 이동 및 페이지 들어가면서 뿌려주는 데이터에 대해선 Thymeleaf를 할용할 것이다. 프로젝트 우클릭 -> Spring -> EditStarters -> Thymeleaf 추가  
  
  10) src/main/resource 밑에 templates 폴더와 html 파일생성(내 경우 main.html). 인코딩 관련은 다루지 않겠음.
  
  11) 만들어진 html페이지에 xmlns:th="https://www.thymeleaf.org" 추가
  ex) 
```html
<!DOCTYPE html>
<html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>

</body>
</html>

```
  
  12) 이러면 따로 suffix나 prefix 없이 controller에서 string으로 값을 반환하면 templates 아래있는 html 파일을 읽어온다. 
  ex) 
```java
package com.example.demo.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class BasicController {

	@GetMapping("/")
	public String mainpage() {
		return "mian";
	}
}

```

여기까지가 컨트롤러를 통한 단순한 페이지 호출이다. 다음 포스팅에는 DB와의 연동과 DTO, DAO, SERVICE을 활용한 서비스 제공까지 정리할 예정이다.


## 느낀점
  
 확실히 일반 스프링 프로젝트보다 접근성이 뛰어나고 설정할 것들이 적은 것같다. 하지만 내가 꼰대 기질이 있어서 그런지는 몰라도 내부적으로 왜 페이지가 불러오고 어떤 설정들이 자동으로 되고 있는지를 알 수 없는 부분들이 많아 개인적으로는 실력있는 개발자가 목표라면 일반 스프링을 어느정도 익힌 후에 스프링부트를 활용하는 것이 더 도움 될 것이란 생각이 든다. 암튼 정말 별다른 설정없이 이렇게 프로젝트를 진행할 수 있다는 것이 참 유용하고 개발에 대한 접근성이 이전보다 올라간 것은 확실한것 같다.

