---
layout:            post
title:             "Spring - Quartz 스케줄링에서 중복 방지하기"
menutitle:         "Spring - Quartz 스케줄링에서 중복 방지하기"
tags:              spring
category:          Spring
author:            geunyoung
cover:             /assets/mountain-alternative-cover.jpg
published:         true
cover:             /assets/mountain-alternative-cover.jpg
language:          KO
comments:          true
---

## 들어가기 앞서...

 내가 시스템 관리하는 프로젝트 중에 3초 단위로 배치를 돌리는 프로세스가 존재하는데, 규모 커짐에 따라 프로세스의 실행시간이 3초가 넘어가 중복발생하는 케이스가 생겼다. 어떻게 처리할지 고민을 하다 블로그에 포스팅하게 되었으며, 샘플소스는 https://github.com/rmsdud2435/Spring5-SchedularSample 참고 바람.

### Quartz


### Resources 설정을 통하여 파일 가져오기



### 정리 및 알게된 점

* Quartz 스케줄러는 시작 후 만족되는 최초 조건에 처음으로 시작
  > 즉, 배치 시간이 0/10 * * ? * * 이고 14:10:03에 시작하였다면 14:10:10에 처음으로 실행
  
* @DisallowConcurrentExecution를 통해 중복방지
  > 배치가 시작할 때, 이미 자기 자신이 실행되고 있으면, 대기열 큐에 들어가서 해당 배치가 끝나자마자 실행  
  > 즉, 0/10으로 배치돌고 작업이 13초가 걸렸다면 20초에 시작하는 것이 아닌 13초에 시작  
  > 만약 프로세스가 늘 배치시작보다 오래 걸린다면 대기열로 인해서 과부화 혹은 overflow가 발생할 수도 있을 것으로 예상  
  > 따라서, 무조건 실행이 되어야 하며 간헐적으로 배치시간보다 실행시간이 길다면 위의 어노테이션 적합
  
* QuartzJobBean클래스를 extentd한 executeInternal() 메소드에서 JobExecutionContext 객체를 활용
  > 배치가 시작할 때, 이미 자기 자신이 실행되고 있으면 실행x  
  > 과부화가 비교적 없을 것으로 추측  
  > 배치간격보다 실행간격이 길면서 과부화를 방지하고 싶으면 사용  
  > 단, 클러스터링을 통한 Quartz에선 인식을 못하여 중복 발생될 수 있음


