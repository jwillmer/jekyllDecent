---
layout:            post
title:             "SSL 인증에 대한 개념잡기"
menutitle:         "SSL 인증에 대한 개념잡기"
category:          Network
author:            geunyoung
cover:             /assets/mountain-alternative-cover.jpg
published:         true
language:          KO
comments:          true
---

## 들어가기 앞서...
  
SM(시스템 운영/관리)을 하다보면 SSL 인증서를 주기적으로 교체를 해야한다. 각 Server(예를 들면, apache/Tomcat, Websphere, WEbtoB/JEUS 등)에 대해서 적용 매뉴얼이 있으며 급기야 만료로 인한 변경의 경우 이전 위치에 이름만 같게 하고 서버를 Web Server만 껐다 키면 적용이 되었다.(서버 종류에 따라 조금씩 차이는 있음) 그렇기에 크게 고민하지 않고 작업을 진행하곤 했다. 따라서 SSL 인증서라는 것이 handshake 방식으로 통신하려는 대상자들이 각각의 인증서와 키를 통해 신뢰성을 확보한다는 정도로만 알고 있어도 별 불편함은 없었다.
  
그러다 한번은 다른 시스템과 RESTful 통신을 하는데 개발에선 발생하지 않다가 운영에 반영을 하니 handshake 에러가 발생하여 고생한 기억이 있고, 또 한번은 운영중인 앱이 특정 핸드폰(iphone이었음)에선 접속이 되지 않았는데 로그 확인 결과 handshake 에러가 발생하여 고생한 적이 있다.  
  
이러한 오류들을 겪고 한번 SSL 인증에 대한 개념을 다시 정리할 필요가 있어 포스팅하게 되었다. 
  
  
### SSL 인증서란?
  
 Secure Socket Layer의 약자로 SSL 프로토콜은 간단하게 웹서버와 브라우저 사이의 보안을 위해 만들어졌다. 간단하게 요약하자면 **대칭키**를 이용하여 암호화 통신을 한다. HTTP에 SSL 적용을 하여 Https 통신을 하게된다. 이러한 암호화 통신을 하기 위해선 SSL 인증서가 필요하다.  
  
 SSL 인증서란 해당 웹 사이트가 해킹에 신뢰있는 사이트인지, 안전한 통신을하는 사이트인지를 구분하기 위해 누군가가 이 사이트가 신뢰가 있는 사이트라고 인증을 해주기 위한 인증서이다. 인증서에는 인증서 소유자의 email, 소유자 이름, 인증서 용도, 인증서 유효기간, 발행기관, public key 등이 포함되어 있다. 즉, 인증서에 서명한 사람을 신뢰한다면, 서명된 인증서 또한 신뢰할수 있는것이다. 또한, **인증서가 다른 인증서를 서명을 해주며 트리구조로 되어 있다.**  
  
구글 크롬을 통해 SSL인증에 관련해서 3가지 케이스를 볼 수 있다.  
  
아래는 https ssl 이 적용된 사이트(공인된 CA의 인증서)  
<figure>
<img src="{{ "/media/img/network/ssl1.PNG" | absolute_url }}" />
<figcaption>출처 : https://namjackson.tistory.com/24 </figcaption>
</figure>
  
  
  
  
아래는 https ssl 이 적용되지 않은 사이트  
<figure>
<img src="{{ "/media/img/network/ssl2.png" | absolute_url }}" />
<figcaption>출처 : https://namjackson.tistory.com/24 </figcaption>
</figure>
  
  
  
  
아래는 https ssl  적용되었지만, 인증서가 보장되지 않은 사설인증(사설 CA)일경우
<figure>
<img src="{{ "/media/img/network/ssl3.png" | absolute_url }}" />
<figcaption>출처 : https://namjackson.tistory.com/24 </figcaption>
</figure>
  
  
  
또한, 인증서의 유효일자 및 간략한 정보를 알고 싶다면 자물쇠를 클릭 후 인증서 탭을 누르면 확인 가능하다.
<figure>
<img src="{{ "/media/img/network/ssl4.PNG" | absolute_url }}" />
</figure>
  
  
  
### 내가 헷갈렸던 부분

#### 인증된 기관이란게 누구에게 인증이 된것인가?  
  
 일단 SSL 개념은 이해했다. 그렇다면 도대체 누가 인증해서 신뢰할 수 있다는 것일까? 당연한 말 일수도 있지만 바로 인증서를 발급한 회사이다. 따라서 인증을 했음에도 SSL이 뚫렸다면 SSL Warranty 정책에 따라 해당 회사에서 배상을 한다. 이 개념도 조금 헷갈렸었는데 예를 들어 누군가가 해당 패킷을 가로채 암호화 알고리즘을 뚫어서 정보를 갈취했다면 SSL 인증회사에서 배상을 하며, 만약 갈취하는 방식이 아닌 인증키를 통해 접근을 했다면 접근한 IP 등 요청자의 정보가 같이 들어오기 때문에 SSL 인증회사에서 배상하는 것이 아니라 해당 정보들을 토대로 해커를 찾는 방식을 취해야 한다.  
  
#### 클라이언트는 어떻게 인증키를 가지고 있을까?
  
 이 부분에 대해서도 늘 궁금했었다. 위에 SSL의 설명을 보면 대칭키를 통해 인증을 한다면 요청자와 응답자 둘 다 키와 인증서가 있어야 한다. 주 업무가 서버 개발이다 보니 해당 서버에 대해 인증서 및 인증키를 등록하는 것은 직접 나의 손을 통해 인증을 하기에 이해했지만 요청자에 대해서는 인증서 작업을 하지도 않는데 어떻게 대칭키를 활용하여 인증을 한다는 것인가? 그 답은 위에 굵은 글씨로 적은 트리 형식으로 상위의 인증서가 다른 인증서를 인증한다는 대목에서 찾을 수 있다. 일반적으로 Web Browser나 핸드폰 단말기 등에 유명한 SSL 인증 회사의 인증서 및 대칭키를 등록한 채로 나온다.  
  
 크롬의 경우로 예를 들자면 내가 딱히 인증서와 대칭키를 등록하지 않아도 크롬 설정 > 고급 > 개인정보 및 보안 > 인증서 관리에 들어가면 몇몇의 유명한 회사들의 인증서들이 등록되어 있는 것을 알 수 있다.  
<figure>
<img src="{{ "/media/img/network/ssl5.PNG" | absolute_url }}" />
</figure>   
  
 Android에서도 설정 > 기타 보안 설정 > 인증서 확인에서 내가 딱히 등록하지 않았지만 등록된 인증서들이 보일 것이다.
 <figure>
<img src="{{ "/media/img/network/ssl6.jpg" | absolute_url }}" />
</figure>   
  
 그렇다면 인증된 인증서는 30~40개 남짓인데 전 세계의 인증서들이 어떻게 등록이 될까? 여기서 아까 말한 트리 형식의 개념이 나오는 것이다. root CA를 통해 해당 CA 인증서 회사와 협약을 맺은 다른 CA 회사들의 인증서들이 인증이 된다.  
  
  
### 문제 해결

 '들어가서 앞서...'란에서 겪었던 문제에 대해서는 아래와 같이 해결하였다.  
  
 * ###### 다른 시스템과 RESTful 통신을 하는데 개발에선 발생하지 않다가 운영에 반영을 하니 handshake 에러가 발생
  >개발에선 잘되었기에 개발에서 등록된 CA와 같은 설정으로 운영에도 등록하였다.  
  
 * ###### 운영중인 앱이 특정 핸드폰(iphone이었음)에선 접속이 되지 않았는데 로그 확인 결과 handshake 에러가 발생
  >B2C앱이라 문의가 올때마다 사용자에게 등록해달라고 부탁할 수 없기에 해당 CA 회사에게 전화해 문제상황에 대해 설명 후 인증서를 새로 받고 해결 완료  


## 참고한 블로그 및 정보

* >SSL인증서에 대한 개념  
https://namjackson.tistory.com/24

* >SAP 관련  
https://kaizen00.tistory.com/22

