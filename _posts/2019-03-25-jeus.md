---
layout:            post
title:             "JEUS - JSP파일이 인식이 안될때"
menutitle:         "JEUS - JSP파일이 인식이 안될때"
tags:              Mistakes
category:          Mistakes
author:            geunyoung
cover:             /assets/mountain-alternative-cover.jpg
published:         true
cover:             /assets/mountain-alternative-cover.jpg
language:          KO
comments:          true
math:		   false
---

## 문제 발생

ajax통신을 통해 특정 영역에 JSP를 렌더시키는 작업을 하였다. 작업 완료후 운영(WebtoB/JEUS 환경에) 반영하여 테스트를 하는데 결과가 제대로 나오지 않았다. 특이한 것이 A라는 변수를 넣어 통신하는데 ajax통신과 전혀 상관없는 B라는 변수의 유무에 따라 에러가 발생하는 것이었다.

그래서 로그를 확인해보니,

```text
[Server_App-94] [WEB-3456] Executing the servlet appServlet failed.
<<__Exception__>>
org.springframework.web.util.NestedServletException: Request processing failed; nested exception is org.apache.tiles.impl.CannotRenderException: JSPException including path '/WEB-INF/views/useDevice/previewUseDevice.jsp'.
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:894)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:789)
	
이하 생략

Caused by: java.lang.NullPointerException
	at jeus_jspwork._WEB_5fINF._views._useDevice._800_previewUseDevice_5fjsp._jspx_meth_c_005fif_005f2(_800_previewUseDevice_5fjsp.java:1523)
	at jeus_jspwork._WEB_5fINF._views._useDevice._800_previewUseDevice_5fjsp._jspService(_800_previewUseDevice_5fjsp.java:459)
	at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)

```

뭐지...? 내가 개발을 잘못했나?

다시 로컬(Apache/Tomcat)에서 테스트 해보니, 잘되는 것이었다. 여기서부터 멘붕에 빠지기 시작하였다.


## 문제 해결 방향

### 첫번째 시도

 가장 처음 의심을 한것은 내가 배포를 잘못한건가에 대한 것이었다. 다시 로컬에서 잘되는 소스를 war로 묶어 재배포하였고 다시 테스트해보니 결과는 실패. war가 풀려있는 디렉토리를 찾아 에러와 관련된 JSP 및 JAVA 파일들을 일일이 다 뒤져보니 시작했다. 잘못 배포되어 있는 소스가 있길 바랬지만 결과는 모두 동일.
 
 ### 두번째 시도
 
  소스는 똑같은데 어떻게 로컬에선 안나고 운영에서 나는 것일까? 그 다음 접근은 로그를 통한 원인 파악이었다. 로그를 찍으며 확인해 보니 우선 컨트롤러까지 탔으며 Request값도 정상, 쿼리 및 비지니스 로직도 정상적으로 통과하였다. 모델 변수를 return해줄때 에러가 발생하였다. 이 후 Postman이라는 통신 S/W를 활요하여 해당 서블릿을 불러보니 똑같이 발생. 그로인해 JSP문제가 아니라고 생각을 하였고 해결하는데 시간을 더 걸리게 하였다.
  
### 세번째 시도
 해결방안을 찾기 위해 인터넷 검색해보니 JSP 파일은  

```xml

<![CDATA[
	SELECT
]]>			
	<foreach collection="list" item="item" index="index" separator=",">
		#{item}
	</foreach>	
<![CDATA[
	FROM 
    테이블명
]]>

```



쿼리를 통해 사용하는 컬럼명을 뽑아와 WebtoB/JEUS 환경에서 
그 컬럼명을 토대로 다른 테이블을 검색해야 하는 쿼리를 만들어야 했다.

예시)
select columnName from AAA으로  a, b, c, d를 뽑았으면
select a,b,c,d from BBB라는 쿼리를 날려야한다.

## 원인

분명 문제가 없어보이는데 왜 안되는 거지? 혹시 foreach문이 잘못되었나? 하며 루프문에 대해 검색해가며 원인을 찾아보려했지만 해결이 할 수 없었다.
원인을 바로바로!!!
변수를 받는 #{item}에 있었다. #{}로 선언을 하면 mybatis문법상 ''를 붙여서 쿼리가 실행이 된다는 것이다.
즉, select 'a','b','c' from BBB으로 인식이 된것이다.
${}으로 수정하니 정상작동하였다.




