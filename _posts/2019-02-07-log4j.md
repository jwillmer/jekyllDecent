---
layout:            post
title:             "log4j를 활용하여 로그 쌓기"
menutitle:         "log4j를 활용하여 로그 쌓기"
date:              2019-02-07 00:40:00 +0300
tags:              spring log4j 로그
category:          Spring
author:            geunyoung
cover:             /assets/mountain-alternative-cover.jpg
published:         true
redirect_from:     "/log4j/"
cover:             /assets/mountain-alternative-cover.jpg
language:          KO
comments:          true
math:			         false
---
 시스템을 운영할때 로그를 남기는 것은 정말 중요합니다.

 하지만 시스템을 운영하거나 개발할때 되는 것에만 치중하다보면 로그에 대해 소홀히 생각하게 되고, 로깅에 대한 이해도가 낮더라도 개발할 때에는 디버깅 등으로 오류 발견하는 것에 대해 아무런 지장이 크지 않아 인터넷에 있는 소스들을 복사/붙여넣기 하는 경우가 종종있습니다.

 시스템을 운영하다 보면 예기치 못한 문제들이 발생하게 되고, 이때 로그가 제대로 쌓여있지 않으면 원인을 찾는데 시간을 많이 투자할 수 밖에 없게 되며,
이해도가 낮으면 왜 안쌓이는지에 대해 원인도 파악 못한채 오류를 찾으러 더 어려운 길을 택하게 된다.

 저 역시 그런 일들을 많이 겪었지만 정작 문제(오류)가 해결되면 또 다시 로그에 대해 중요성을 잊어버리고 같은 실수를 반복했습니다. 그러다 로그에 대해 정리의 필요성을 느끼고 포스팅합니다. 

## log4j이란?
 log4j는 자바 어플리케이션에서 빠르고 효과적으로 로깅 할 수 있도록 도와주는 오픈 소스 프로젝트입니다.
 
## log4j의 구성요소
 log4j에는 3가지 요소인 Logger, Appender, Root가 있습니다.
  - Root : 기본적으로 출력 될 로그 출력.(ex. root 레벨이 INFO이면, logger들의 레벨이 DEBUG여도 INFO까지만 출력)
  - Logger : 출력 될 내용들
  - Appender : 출력 포맷 설정. 읽기 쉽게 만드는 형식.(ex. 어떤 패턴으로 찍을지)

## log4j 레벨
log level은 fatal, error, warn, info, debug, trace 순이며, 설정한 log level보다 오른쪽인 level은 logger에 기록 되지 않습니다.(ex. INFO로 설정시 debug, trace의 level은 기록되지 않습니다.)

## Spring에 적용하기
1. log4j 라이브러리 추가 - pom.xml에서하거나 jar를 다운받아 추가
2. web.xml에 설정 추가

```xml
  <context-param>
    <param-name>log4jConfigLocation</param-name>
    <param-value>log4j설정 위치</param-value>
  </context-param>
```

## log4j 설정하기
log4j의 설정은 크게 xml형식과 properties형식이 있다. xml형식을 더 권장하며, 실제로도 최신 log4j은 xml과 json을 이용한 설정만 지원하고 있습니다.

```xml
<?xml version="1.0" encoding="UTF-8"?>

<Configuration status="trace" monitorInterval="1" >
	
    <Appenders>
	<!-- 콘솔로그 -->
	<Console name="Console" target="SYSTEM_OUT">
		<PatternLayout pattern="%p %d [%t] [%c] %-15.15M %m%n" />
	</Console>
	
	<!-- bizMOB 에러로그 -->
	<RollingRandomAccessFile name="bizmob-error"
		fileName= "${sys:bizmobCustHome}/logs/bizmob_error.log"
		filePattern="${sys:bizmobCustHome}/logs/$${date:yyyyMMdd}/bizmob_error.log.%d{yyyyMMdd}"
		immediateFlush="false" append="false">
		<PatternLayout pattern="%p %d [%t] [%c] %-15.15M %m%n" />
		<Policies>
			<TimeBasedTriggeringPolicy interval="86400" />
			<SizeBasedTriggeringPolicy />
		</Policies>
		<DefaultRolloverStrategy max="20" />
	</RollingRandomAccessFile>
	
	<!-- bizMOB 일반로그 -->
	<RollingRandomAccessFile name="bizmob"
		fileName="${sys:bizmobCustHome}/logs/bizmob.log"
		filePattern="${sys:bizmobCustHome}/logs/$${date:yyyyMMdd}/bizmob.log.%d{yyyyMMdd}"
		immediateFlush="false" append="true">
		<PatternLayout pattern="%p %d [%t] [%c] %M %m%n" />
		<Policies>
			<TimeBasedTriggeringPolicy interval="1" modulate="true"/>
		</Policies>
		<DefaultRolloverStrategy max="20" />
	</RollingRandomAccessFile>
	
	<Async name="Async-log">
		<AppenderRef ref="bizmob" />
	</Async>
	<Async name="Async-error">
		<AppenderRef ref="bizmob-error" />
	</Async>
	</Appenders>
	
	<Loggers>
		<Root level="DEBUG" additivity="false">
			<AppenderRef ref="Console" level="DEBUG" />
			<AppenderRef ref="Async-log" level="DEBUG" />
			<AppenderRef ref="Async-error" level="WARN" />
		</Root>
		
		 
		<Logger name="org.springframework" level="WARN" additivity="false">
			<AppenderRef ref="Console" level="DEBUG" />
			<AppenderRef ref="Async-log" level="DEBUG" />
			<AppenderRef ref="Async-error" level="WARN" />
		</Logger>
		 
		<Logger name="org.apache" level="WARN" additivity="false">
			<appender-ref ref="Async-error" />
			<appender-ref ref="Async-db-debug" />
		</Logger>
		
		<Logger name="net.sf.ehcache" level="WARN" additivity="false">
			<appender-ref ref="Async-error" />
			<appender-ref ref="Async-db-debug" />
		</Logger>
	</Loggers>
</Configuration>
```
